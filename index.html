<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ventas - Alimentos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            min-width: 400px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-form h2 {
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #4a5568;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Main Dashboard Styles */
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .welcome-text {
            font-size: 1.5rem;
            color: #4a5568;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #e53e3e;
            padding: 8px 20px;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #c53030;
        }

        /* Navigation */
        .nav-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .nav-btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
            justify-content: center;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(66, 153, 225, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* Content Areas */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8rem;
            color: #4a5568;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background-color: #f7fafc;
            transform: translateX(2px);
            transition: all 0.3s ease;
        }

        /* Buttons */
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #dd6b20 0%, #c05621 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #333;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(66, 153, 225, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(66, 153, 225, 0.4);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Filters */
        .filters {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 600;
            color: #4a5568;
        }

        .filter-group input,
        .filter-group select {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alerts */
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            font-weight: 600;
            display: none;
        }

        .alert-success {
            background-color: #c6f6d5;
            border: 2px solid #9ae6b4;
            color: #22543d;
        }

        .alert-error {
            background-color: #fed7d7;
            border: 2px solid #feb2b2;
            color: #742a2a;
        }

        .alert-info {
            background-color: #bee3f8;
            border: 2px solid #90cdf4;
            color: #2a4365;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .login-form {
                min-width: auto;
                margin: 20px;
                padding: 30px 20px;
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .nav-buttons {
                justify-content: center;
            }

            .nav-btn {
                min-width: 120px;
                padding: 12px 20px;
                font-size: 13px;
            }

            .section-card {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                justify-content: space-between;
            }
        }

        @media (max-width: 480px) {
            .nav-btn {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 12px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-value {
                font-size: 2rem;
            }

            th, td {
                padding: 10px 8px;
                font-size: 14px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div id="loginSection" class="login-container">
        <div class="login-form">
            <h2><i class="fas fa-utensils"></i> Sistema de Ventas</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" class="hidden">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="welcome-text">
                    <span id="greeting"></span>, <span id="currentUserName"></span>
                </div>
                <div class="user-info">
                    <span id="currentDateTime"></span>
                    <button class="btn logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </button>
                </div>
            </div>

            <!-- Navigation -->
            <div class="nav-container">
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showSection('productos')">
                        <i class="fas fa-box"></i> Productos
                    </button>
                    <button class="nav-btn" onclick="showSection('clientes')">
                        <i class="fas fa-users"></i> Clientes
                    </button>
                    <button class="nav-btn" onclick="showSection('ventas')">
                        <i class="fas fa-shopping-cart"></i> Nueva Venta
                    </button>
                    <button class="nav-btn" onclick="showSection('historial')">
                        <i class="fas fa-history"></i> Historial Ventas
                    </button>
                    <button class="nav-btn" onclick="showSection('porPagar')">
                        <i class="fas fa-money-bill-wave"></i> Por Pagar
                    </button>
                    <button class="nav-btn" onclick="showSection('estadisticas')">
                        <i class="fas fa-chart-bar"></i> Estadísticas
                    </button>
                    <button class="nav-btn" onclick="showSection('usuarios')">
                        <i class="fas fa-user-cog"></i> Usuarios
                    </button>
                </div>
            </div>

            <!-- Alerts -->
            <div id="alertSuccess" class="alert alert-success"></div>
            <div id="alertError" class="alert alert-error"></div>
            <div id="alertInfo" class="alert alert-info"></div>

            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Cargando...</p>
            </div>

            <!-- Productos Section -->
            <div id="productosSection" class="content-section active">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-box"></i> Gestión de Productos
                    </h2>
                    
                    <form id="productoForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombreProducto">Nombre del Producto</label>
                                <input type="text" id="nombreProducto" name="nombreProducto" required>
                            </div>
                            <div class="form-group">
                                <label for="cantidadProducto">Cantidad</label>
                                <input type="number" id="cantidadProducto" name="cantidadProducto" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="inversionProducto">Inversión Total</label>
                                <input type="number" id="inversionProducto" name="inversionProducto" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="valorUnitario">Valor Unitario</label>
                                <input type="number" id="valorUnitario" name="valorUnitario" min="0" step="0.01" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus"></i> Agregar Producto
                        </button>
                    </form>

                    <div class="table-container">
                        <table id="productosTable">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Inversión</th>
                                    <th>Valor Unitario</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productosTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Clientes Section -->
            <div id="clientesSection" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-users"></i> Gestión de Clientes
                    </h2>
                    
                    <form id="clienteForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombreCliente">Nombre Completo</label>
                                <input type="text" id="nombreCliente" name="nombreCliente" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-user-plus"></i> Agregar Cliente
                        </button>
                    </form>

                    <div class="filters">
                        <div class="filter-group">
                            <label>Buscar:</label>
                            <input type="text" id="buscarCliente" placeholder="Buscar por nombre...">
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="clientesTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre Completo</th>
                                    <th>Fecha Registro</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="clientesTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ventas Section -->
            <div id="ventasSection" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-shopping-cart"></i> Nueva Venta
                    </h2>
                    
                    <form id="ventaForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clienteVenta">Cliente</label>
                                <select id="clienteVenta" name="clienteVenta" required>
                                    <option value="">Seleccionar cliente...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="productoVenta">Producto</label>
                                <select id="productoVenta" name="productoVenta" required>
                                    <option value="">Seleccionar producto...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cantidadVenta">Cantidad</label>
                                <input type="number" id="cantidadVenta" name="cantidadVenta" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="medioPago">Medio de Pago</label>
                                <select id="medioPago" name="medioPago" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Efectivo">Efectivo</option>
                                    <option value="Electrónico">Electrónico</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="estadoPago">Estado del Pago</label>
                                <select id="estadoPago" name="estadoPago" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Pagado">Pagado</option>
                                    <option value="Pendiente">Pendiente</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="valorTotal">Valor Total</label>
                                <input type="number" id="valorTotal" name="valorTotal" readonly>
                            </div>
                            <div class="form-group">
                                <label for="montoRecibido">Monto Recibido</label>
                                <input type="number" id="montoRecibido" name="montoRecibido" min="0" step="0.01">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-cash-register"></i> Procesar Venta
                        </button>
                    </form>
                </div>
            </div>

            <!-- Historial de Ventas Section -->
            <div id="historialSection" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i> Historial de Ventas
                    </h2>

                    <div class="filters">
                        <div class="filter-group">
                            <label>Fecha Desde:</label>
                            <input type="date" id="fechaDesde">
                        </div>
                        <div class="filter-group">
                            <label>Fecha Hasta:</label>
                            <input type="date" id="fechaHasta">
                        </div>
                        <div class="filter-group">
                            <label>Producto:</label>
                            <select id="filtroProducto">
                                <option value="">Todos los productos</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Cliente:</label>
                            <input type="text" id="filtroCliente" placeholder="Buscar cliente...">
                        </div>
                        <button class="btn" onclick="filtrarVentas()">
                            <i class="fas fa-filter"></i> Filtrar
                        </button>
                    </div>

                    <div class="table-container">
                        <table id="historialTable">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Valor Total</th>
                                    <th>Medio Pago</th>
                                    <th>Estado</th>
                                    <th>Vendedor</th>
                                </tr>
                            </thead>
                            <tbody id="historialTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Por Pagar Section -->
            <div id="porPagarSection" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-money-bill-wave"></i> Clientes por Pagar
                    </h2>

                    <div class="table-container">
                        <table id="porPagarTable">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Fecha Venta</th>
                                    <th>Producto</th>
                                    <th>Total</th>
                                    <th>Pagado</th>
                                    <th>Pendiente</th>
                                    <th>Días Vencido</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="porPagarTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Estadísticas Section -->
            <div id="estadisticasSection" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i> Estadísticas de Ventas
                    </h2>

                    <div class="filters">
                        <div class="filter-group">
                            <label>Mes:</label>
                            <select id="estadisticasMes">
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Año:</label>
                            <select id="estadisticasAno"></select>
                        </div>
                        <button class="btn" onclick="cargarEstadisticas()">
                            <i class="fas fa-chart-line"></i> Generar Estadísticas
                        </button>
                    </div>

                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalVentas">0</div>
                            <div class="stat-label">Total Ventas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="ingresosMes">$0</div>
                            <div class="stat-label">Ingresos del Mes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="clientesActivos">0</div>
                            <div class="stat-label">Clientes Activos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="productosMasVendidos">0</div>
                            <div class="stat-label">Productos + Vendidos</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="estadisticasTable">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad Vendida</th>
                                    <th>Ingresos Generados</th>
                                    <th>% del Total</th>
                                </tr>
                            </thead>
                            <tbody id="estadisticasTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Usuarios Section -->
            <div id="usuariosSection" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-user-cog"></i> Gestión de Usuarios
                    </h2>
                    
                    <form id="usuarioForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombreUsuario">Nombre Completo</label>
                                <input type="text" id="nombreUsuario" name="nombreUsuario" required>
                            </div>
                            <div class="form-group">
                                <label for="usuarioLogin">Usuario</label>
                                <input type="text" id="usuarioLogin" name="usuarioLogin" required>
                            </div>
                            <div class="form-group">
                                <label for="contraseñaUsuario">Contraseña</label>
                                <input type="password" id="contraseñaUsuario" name="contraseñaUsuario" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-user-plus"></i> Crear Usuario
                        </button>
                    </form>

                    <div class="table-container">
                        <table id="usuariosTable">
                            <thead>
                                <tr>
                                    <th>Nombre Completo</th>
                                    <th>Usuario</th>
                                    <th>Fecha Creación</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usuariosTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Abonos -->
    <div id="abonoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalAbono()">&times;</span>
            <h2><i class="fas fa-money-bill-wave"></i> Realizar Abono</h2>
            <form id="abonoForm">
                <input type="hidden" id="ventaIdAbono">
                <div class="form-group">
                    <label>Cliente:</label>
                    <span id="clienteAbono"></span>
                </div>
                <div class="form-group">
                    <label>Total a Pagar:</label>
                    <span id="totalAbono"></span>
                </div>
                <div class="form-group">
                    <label>Ya Pagado:</label>
                    <span id="pagadoAbono"></span>
                </div>
                <div class="form-group">
                    <label>Pendiente:</label>
                    <span id="pendienteAbono"></span>
                </div>
                <div class="form-group">
                    <label for="montoAbono">Monto del Abono:</label>
                    <input type="number" id="montoAbono" min="0" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> Realizar Abono
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para Editar Producto -->
    <div id="editarProductoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalEditarProducto()">&times;</span>
            <h2><i class="fas fa-edit"></i> Editar Producto</h2>
            <form id="editarProductoForm">
                <input type="hidden" id="productoIdEditar">
                <div class="form-row">
                    <div class="form-group">
                        <label for="nombreProductoEditar">Nombre del Producto</label>
                        <input type="text" id="nombreProductoEditar" required>
                    </div>
                    <div class="form-group">
                        <label for="cantidadProductoEditar">Cantidad</label>
                        <input type="number" id="cantidadProductoEditar" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="inversionProductoEditar">Inversión Total</label>
                        <input type="number" id="inversionProductoEditar" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="valorUnitarioEditar">Valor Unitario</label>
                        <input type="number" id="valorUnitarioEditar" min="0" step="0.01" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </form>
        </div>
    </div>

    <script>
        // Configuración global
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwMsQIcvV3uFR5aiZOBGbRU5ZeihQ4clmL468Njx8lPqO80vFUUDDG7Phy5PGTlHJA/exec';
        let currentUser = null;
        let productos = [];
        let clientes = [];
        let ventas = [];
        let usuarios = [];

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            setupEventListeners();
            setDefaultDates();
        }

        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Forms
            document.getElementById('productoForm').addEventListener('submit', handleProductoSubmit);
            document.getElementById('clienteForm').addEventListener('submit', handleClienteSubmit);
            document.getElementById('ventaForm').addEventListener('submit', handleVentaSubmit);
            document.getElementById('usuarioForm').addEventListener('submit', handleUsuarioSubmit);
            document.getElementById('abonoForm').addEventListener('submit', handleAbonoSubmit);
            document.getElementById('editarProductoForm').addEventListener('submit', handleEditarProductoSubmit);
            
            // Calculadora de venta
            document.getElementById('productoVenta').addEventListener('change', calcularTotal);
            document.getElementById('cantidadVenta').addEventListener('input', calcularTotal);
            
            // Filtros
            document.getElementById('buscarCliente').addEventListener('input', filtrarClientes);
        }

        function setDefaultDates() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('fechaDesde').value = firstDay.toISOString().split('T')[0];
            document.getElementById('fechaHasta').value = today.toISOString().split('T')[0];
            
            // Configurar año y mes actual para estadísticas
            const mesSelect = document.getElementById('estadisticasMes');
            const anoSelect = document.getElementById('estadisticasAno');
            
            mesSelect.value = today.getMonth() + 1;
            
            // Generar opciones de años
            const currentYear = today.getFullYear();
            for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                anoSelect.appendChild(option);
            }
        }

        // Funciones de autenticación
        async function handleLogin(e) {
            e.preventDefault();
            showLoading();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'login',
                        username: username,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = result.user;
                    showDashboard();
                    await loadInitialData();
                    showAlert('Bienvenido ' + currentUser.nombre, 'success');
                } else {
                    showAlert('Usuario o contraseña incorrectos', 'error');
                }
            } catch (error) {
                console.error('Error en login:', error);
                showAlert('Error de conexión. Intente nuevamente.', 'error');
            }
            
            hideLoading();
        }

        function showDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainDashboard').classList.remove('hidden');
            
            document.getElementById('currentUserName').textContent = currentUser.nombre;
            updateGreeting();
        }

        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) greeting = 'Buenos días';
            else if (hour < 18) greeting = 'Buenas tardes';
            else greeting = 'Buenas noches';
            
            document.getElementById('greeting').textContent = greeting;
        }

        function updateDateTime() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('es-ES', options);
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('mainDashboard').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        // Navegación
        function showSection(section) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(s => s.classList.remove('active'));
            
            // Remover clase active de botones
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => btn.classList.remove('active'));
            
            // Mostrar sección seleccionada
            document.getElementById(section + 'Section').classList.add('active');
            
            // Activar botón correspondiente
            event.target.classList.add('active');
            
            // Cargar datos específicos de la sección
            switch(section) {
                case 'productos':
                    cargarProductos();
                    break;
                case 'clientes':
                    cargarClientes();
                    break;
                case 'ventas':
                    cargarDatosVenta();
                    break;
                case 'historial':
                    cargarHistorialVentas();
                    break;
                case 'porPagar':
                    cargarClientesPorPagar();
                    break;
                case 'estadisticas':
                    cargarEstadisticas();
                    break;
                case 'usuarios':
                    cargarUsuarios();
                    break;
            }
        }

        // Funciones API
        async function apiCall(action, data = {}) {
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        user: currentUser.usuario,
                        ...data
                    })
                });
                
                return await response.json();
            } catch (error) {
                console.error('Error en API call:', error);
                throw error;
            }
        }

        // Cargar datos iniciales
        async function loadInitialData() {
            showLoading();
            try {
                await cargarProductos();
                await cargarClientes();
                await cargarUsuarios();
            } catch (error) {
                console.error('Error cargando datos iniciales:', error);
                showAlert('Error cargando datos iniciales', 'error');
            }
            hideLoading();
        }

        // Gestión de Productos
        async function cargarProductos() {
            try {
                const result = await apiCall('getProductos');
                if (result.success) {
                    productos = result.data;
                    renderProductosTable();
                    actualizarSelectProductos();
                }
            } catch (error) {
                console.error('Error cargando productos:', error);
                showAlert('Error cargando productos', 'error');
            }
        }

        function renderProductosTable() {
            const tbody = document.getElementById('productosTableBody');
            tbody.innerHTML = '';
            
            productos.forEach(producto => {
                const row = document.createElement('tr');
                const estado = producto.cantidad > 0 ? 'Disponible' : 'Agotado';
                const estadoClass = producto.cantidad > 0 ? 'text-success' : 'text-danger';
                
                row.innerHTML = `
                    <td>${producto.nombre}</td>
                    <td>${producto.cantidad}</td>
                    <td>${parseFloat(producto.inversion).toLocaleString()}</td>
                    <td>${parseFloat(producto.valorUnitario).toLocaleString()}</td>
                    <td><span class="${estadoClass}">${estado}</span></td>
                    <td>
                        <button class="btn btn-warning" onclick="editarProducto('${producto.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="eliminarProducto('${producto.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function handleProductoSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const formData = new FormData(e.target);
            const productoData = {
                nombre: formData.get('nombreProducto'),
                cantidad: parseInt(formData.get('cantidadProducto')),
                inversion: parseFloat(formData.get('inversionProducto')),
                valorUnitario: parseFloat(formData.get('valorUnitario'))
            };
            
            try {
                const result = await apiCall('addProducto', productoData);
                if (result.success) {
                    showAlert('Producto agregado exitosamente', 'success');
                    e.target.reset();
                    await cargarProductos();
                } else {
                    showAlert('Error agregando producto: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error de conexión', 'error');
            }
            
            hideLoading();
        }

        function editarProducto(id) {
            const producto = productos.find(p => p.id === id);
            if (producto) {
                document.getElementById('productoIdEditar').value = id;
                document.getElementById('nombreProductoEditar').value = producto.nombre;
                document.getElementById('cantidadProductoEditar').value = producto.cantidad;
                document.getElementById('inversionProductoEditar').value = producto.inversion;
                document.getElementById('valorUnitarioEditar').value = producto.valorUnitario;
                document.getElementById('editarProductoModal').style.display = 'block';
            }
        }

        async function handleEditarProductoSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const formData = new FormData(e.target);
            const productoData = {
                id: formData.get('productoIdEditar') || document.getElementById('productoIdEditar').value,
                nombre: document.getElementById('nombreProductoEditar').value,
                cantidad: parseInt(document.getElementById('cantidadProductoEditar').value),
                inversion: parseFloat(document.getElementById('inversionProductoEditar').value),
                valorUnitario: parseFloat(document.getElementById('valorUnitarioEditar').value)
            };
            
            try {
                const result = await apiCall('updateProducto', productoData);
                if (result.success) {
                    showAlert('Producto actualizado exitosamente', 'success');
                    cerrarModalEditarProducto();
                    await cargarProductos();
                } else {
                    showAlert('Error actualizando producto: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error de conexión', 'error');
            }
            
            hideLoading();
        }

        function cerrarModalEditarProducto() {
            document.getElementById('editarProductoModal').style.display = 'none';
        }

        async function eliminarProducto(id) {
            if (confirm('¿Estás seguro de que deseas eliminar este producto?')) {
                showLoading();
                try {
                    const result = await apiCall('deleteProducto', { id });
                    if (result.success) {
                        showAlert('Producto eliminado exitosamente', 'success');
                        await cargarProductos();
                    } else {
                        showAlert('Error eliminando producto: ' + result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showAlert('Error de conexión', 'error');
                }
                hideLoading();
            }
        }

        function actualizarSelectProductos() {
            const selects = ['productoVenta', 'filtroProducto'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Mantener la primera opción
                    const firstOption = select.querySelector('option[value=""]');
                    select.innerHTML = '';
                    if (firstOption) select.appendChild(firstOption);
                    
                    productos.forEach(producto => {
                        if (selectId === 'productoVenta' && producto.cantidad <= 0) return;
                        
                        const option = document.createElement('option');
                        option.value = producto.id;
                        option.textContent = `${producto.nombre} (${producto.cantidad} disponibles)`;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Gestión de Clientes
        async function cargarClientes() {
            try {
                const result = await apiCall('getClientes');
                if (result.success) {
                    clientes = result.data;
                    renderClientesTable();
                    actualizarSelectClientes();
                }
            } catch (error) {
                console.error('Error cargando clientes:', error);
                showAlert('Error cargando clientes', 'error');
            }
        }

        function renderClientesTable() {
            const tbody = document.getElementById('clientesTableBody');
            tbody.innerHTML = '';
            
            clientes.forEach(cliente => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cliente.id}</td>
                    <td>${cliente.nombre}</td>
                    <td>${new Date(cliente.fechaRegistro).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-danger" onclick="eliminarCliente('${cliente.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function handleClienteSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const formData = new FormData(e.target);
            const clienteData = {
                nombre: formData.get('nombreCliente')
            };
            
            try {
                const result = await apiCall('addCliente', clienteData);
                if (result.success) {
                    showAlert('Cliente agregado exitosamente', 'success');
                    e.target.reset();
                    await cargarClientes();
                } else {
                    showAlert('Error agregando cliente: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error de conexión', 'error');
            }
            
            hideLoading();
        }

        async function eliminarCliente(id) {
            if (confirm('¿Estás seguro de que deseas eliminar este cliente?')) {
                showLoading();
                try {
                    const result = await apiCall('deleteCliente', { id });
                    if (result.success) {
                        showAlert('Cliente eliminado exitosamente', 'success');
                        await cargarClientes();
                    } else {
                        showAlert('Error eliminando cliente: ' + result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showAlert('Error de conexión', 'error');
                }
                hideLoading();
            }
        }

        function actualizarSelectClientes() {
            const select = document.getElementById('clienteVenta');
            if (select) {
                const firstOption = select.querySelector('option[value=""]');
                select.innerHTML = '';
                if (firstOption) select.appendChild(firstOption);
                
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.nombre;
                    select.appendChild(option);
                });
            }
        }

        function filtrarClientes() {
            const filtro = document.getElementById('buscarCliente').value.toLowerCase();
            const rows = document.querySelectorAll('#clientesTableBody tr');
            
            rows.forEach(row => {
                const nombre = row.cells[1].textContent.toLowerCase();
                if (nombre.includes(filtro)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Gestión de Ventas
        async function cargarDatosVenta() {
            await cargarProductos();
            await cargarClientes();
        }

        function calcularTotal() {
            const productoId = document.getElementById('productoVenta').value;
            const cantidad = parseInt(document.getElementById('cantidadVenta').value) || 0;
            
            if (productoId && cantidad > 0) {
                const producto = productos.find(p => p.id === productoId);
                if (producto) {
                    const total = producto.valorUnitario * cantidad;
                    document.getElementById('valorTotal').value = total.toFixed(2);
                    document.getElementById('montoRecibido').max = total;
                }
            } else {
                document.getElementById('valorTotal').value = '';
            }
        }

        async function handleVentaSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const formData = new FormData(e.target);
            const ventaData = {
                clienteId: formData.get('clienteVenta'),
                productoId: formData.get('productoVenta'),
                cantidad: parseInt(formData.get('cantidadVenta')),
                medioPago: formData.get('medioPago'),
                estadoPago: formData.get('estadoPago'),
                valorTotal: parseFloat(formData.get('valorTotal')),
                montoRecibido: parseFloat(formData.get('montoRecibido')) || 0
            };
            
            // Validaciones
            const producto = productos.find(p => p.id === ventaData.productoId);
            if (!producto || producto.cantidad < ventaData.cantidad) {
                showAlert('No hay suficiente stock del producto seleccionado', 'error');
                hideLoading();
                return;
            }
            
            if (ventaData.estadoPago === 'Pagado' && ventaData.montoRecibido < ventaData.valorTotal) {
                showAlert('El monto recibido debe ser igual o mayor al valor total para marcar como pagado', 'error');
                hideLoading();
                return;
            }
            
            try {
                const result = await apiCall('addVenta', ventaData);
                if (result.success) {
                    showAlert('Venta procesada exitosamente', 'success');
                    e.target.reset();
                    await cargarProductos(); // Actualizar stock
                } else {
                    showAlert('Error procesando venta: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error de conexión', 'error');
            }
            
            hideLoading();
        }

        // Historial de Ventas
        async function cargarHistorialVentas() {
            try {
                const result = await apiCall('getVentas');
                if (result.success) {
                    ventas = result.data;
                    renderHistorialTable();
                }
            } catch (error) {
                console.error('Error cargando historial:', error);
                showAlert('Error cargando historial de ventas', 'error');
            }
        }

        function renderHistorialTable() {
            const tbody = document.getElementById('historialTableBody');
            tbody.innerHTML = '';
            
            ventas.forEach(venta => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(venta.fecha).toLocaleDateString()}</td>
                    <td>${venta.cliente}</td>
                    <td>${venta.producto}</td>
                    <td>${venta.cantidad}</td>
                    <td>${parseFloat(venta.valorTotal).toLocaleString()}</td>
                    <td>${venta.medioPago}</td>
                    <td><span class="${venta.estadoPago === 'Pagado' ? 'text-success' : 'text-warning'}">${venta.estadoPago}</span></td>
                    <td>${venta.vendedor}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function filtrarVentas() {
            const fechaDesde = document.getElementById('fechaDesde').value;
            const fechaHasta = document.getElementById('fechaHasta').value;
            const productoFiltro = document.getElementById('filtroProducto').value;
            const clienteFiltro = document.getElementById('filtroCliente').value.toLowerCase();
            
            const rows = document.querySelectorAll('#historialTableBody tr');
            
            rows.forEach(row => {
                let mostrar = true;
                
                // Filtro por fecha
                if (fechaDesde || fechaHasta) {
                    const fechaVenta = new Date(row.cells[0].textContent.split('/').reverse().join('-'));
                    if (fechaDesde && fechaVenta < new Date(fechaDesde)) mostrar = false;
                    if (fechaHasta && fechaVenta > new Date(fechaHasta)) mostrar = false;
                }
                
                // Filtro por cliente
                if (clienteFiltro && !row.cells[1].textContent.toLowerCase().includes(clienteFiltro)) {
                    mostrar = false;
                }
                
                row.style.display = mostrar ? '' : 'none';
            });
        }

        // Clientes por Pagar
        async function cargarClientesPorPagar() {
            try {
                const result = await apiCall('getClientesPorPagar');
                if (result.success) {
                    renderPorPagarTable(result.data);
                }
            } catch (error) {
                console.error('Error cargando clientes por pagar:', error);
                showAlert('Error cargando clientes por pagar', 'error');
            }
        }

        function renderPorPagarTable(data) {
            const tbody = document.getElementById('porPagarTableBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const row = document.createElement('tr');
                const diasVencido = Math.floor((new Date() - new Date(item.fechaVenta)) / (1000 * 60 * 60 * 24));
                
                row.innerHTML = `
                    <td>${item.cliente}</td>
                    <td>${new Date(item.fechaVenta).toLocaleDateString()}</td>
                    <td>${item.producto}</td>
                    <td>${parseFloat(item.total).toLocaleString()}</td>
                    <td>${parseFloat(item.pagado).toLocaleString()}</td>
                    <td>${parseFloat(item.pendiente).toLocaleString()}</td>
                    <td><span class="${diasVencido > 7 ? 'text-danger' : 'text-warning'}">${diasVencido} días</span></td>
                    <td>
                        <button class="btn btn-success" onclick="abrirModalAbono('${item.ventaId}', '${item.cliente}', ${item.total}, ${item.pagado}, ${item.pendiente})">
                            <i class="fas fa-money-bill"></i> Abonar
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function abrirModalAbono(ventaId, cliente, total, pagado, pendiente) {
            document.getElementById('ventaIdAbono').value = ventaId;
            document.getElementById('clienteAbono').textContent = cliente;
            document.getElementById('totalAbono').textContent = parseFloat(total).toLocaleString();
            ocument.getElementById('pagadoAbono').textContent = parseFloat(pagado).toLocaleString();
            document.getElementById('pendienteAbono').textContent = parseFloat(pendiente).toLocaleString();
            document.getElementById('montoAbono').max = pendiente;
            document.getElementById('abonoModal').style.display = 'block';
        }

        function cerrarModalAbono() {
            document.getElementById('abonoModal').style.display = 'none';
            document.getElementById('abonoForm').reset();
        }

        async function handleAbonoSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const ventaId = document.getElementById('ventaIdAbono').value;
            const montoAbono = parseFloat(document.getElementById('montoAbono').value);
            
            try {
                const result = await apiCall('addAbono', {
                    ventaId: ventaId,
                    monto: montoAbono
                });
                
                if (result.success) {
                    showAlert('Abono registrado exitosamente', 'success');
                    cerrarModalAbono();
                    await cargarClientesPorPagar();
                } else {
                    showAlert('Error registrando abono: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error de conexión', 'error');
            }
            
            hideLoading();
        }

        // Estadísticas
        async function cargarEstadisticas() {
            const mes = document.getElementById('estadisticasMes').value;
            const ano = document.getElementById('estadisticasAno').value;
            
            showLoading();
            try {
                const result = await apiCall('getEstadisticas', { mes, ano });
                if (result.success) {
                    renderEstadisticas(result.data);
                }
            } catch (error) {
                console.error('Error cargando estadísticas:', error);
                showAlert('Error cargando estadísticas', 'error');
            }
            hideLoading();
        }

        function renderEstadisticas(data) {
            // Actualizar tarjetas de estadísticas
            document.getElementById('totalVentas').textContent = data.totalVentas;
            document.getElementById('ingresosMes').textContent = parseFloat(data.ingresosMes).toLocaleString();
            document.getElementById('clientesActivos').textContent = data.clientesActivos;
            document.getElementById('productosMasVendidos').textContent = data.productosMasVendidos;
            
            // Renderizar tabla de productos
            const tbody = document.getElementById('estadisticasTableBody');
            tbody.innerHTML = '';
            
            data.productoStats.forEach(producto => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${producto.nombre}</td>
                    <td>${producto.cantidadVendida}</td>
                    <td>${parseFloat(producto.ingresos).toLocaleString()}</td>
                    <td>${producto.porcentaje}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Gestión de Usuarios
        async function cargarUsuarios() {
            try {
                const result = await apiCall('getUsuarios');
                if (result.success) {
                    usuarios = result.data;
                    renderUsuariosTable();
                }
            } catch (error) {
                console.error('Error cargando usuarios:', error);
                showAlert('Error cargando usuarios', 'error');
            }
        }

        function renderUsuariosTable() {
            const tbody = document.getElementById('usuariosTableBody');
            tbody.innerHTML = '';
            
            usuarios.forEach(usuario => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${usuario.nombre}</td>
                    <td>${usuario.usuario}</td>
                    <td>${new Date(usuario.fechaCreacion).toLocaleDateString()}</td>
                    <td><span class="text-success">Activo</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="eliminarUsuario('${usuario.id}')">
                            <i class="fas fa-user-times"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function handleUsuarioSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const formData = new FormData(e.target);
            const usuarioData = {
                nombre: formData.get('nombreUsuario'),
                usuario: formData.get('usuarioLogin'),
                contraseña: formData.get('contraseñaUsuario')
            };
            
            try {
                const result = await apiCall('addUsuario', usuarioData);
                if (result.success) {
                    showAlert('Usuario creado exitosamente', 'success');
                    e.target.reset();
                    await cargarUsuarios();
                } else {
                    showAlert('Error creando usuario: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error de conexión', 'error');
            }
            
            hideLoading();
        }

        async function eliminarUsuario(id) {
            if (currentUser.id === id) {
                showAlert('No puedes eliminar tu propio usuario', 'error');
                return;
            }
            
            if (confirm('¿Estás seguro de que deseas eliminar este usuario?')) {
                showLoading();
                try {
                    const result = await apiCall('deleteUsuario', { id });
                    if (result.success) {
                        showAlert('Usuario eliminado exitosamente', 'success');
                        await cargarUsuarios();
                    } else {
                        showAlert('Error eliminando usuario: ' + result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showAlert('Error de conexión', 'error');
                }
                hideLoading();
            }
        }

        // Funciones de utilidad
        function showAlert(message, type) {
            const alertElement = document.getElementById('alert' + type.charAt(0).toUpperCase() + type.slice(1));
            alertElement.textContent = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Generar ID único
        function generarId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Formatear números
        function formatearNumero(numero) {
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(numero);
        }

        // Formatear fecha
        function formatearFecha(fecha) {
            return new Date(fecha).toLocaleDateString('es-CO', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
</body>
</html>


